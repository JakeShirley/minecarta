<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minecraft Map API Tester</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #1a1a2e;
      color: #eee;
    }
    h1 {
      color: #6dd5ed;
      border-bottom: 2px solid #6dd5ed;
      padding-bottom: 10px;
    }
    h2 {
      color: #b8d4e3;
      margin-top: 30px;
      margin-bottom: 15px;
    }
    h3 {
      color: #8ab4c9;
      margin: 15px 0 10px;
      font-size: 14px;
    }
    .section {
      background: #16213e;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid #0f3460;
    }
    .endpoint {
      margin-bottom: 15px;
    }
    .endpoint-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .method {
      padding: 4px 10px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 12px;
    }
    .method.get { background: #2ecc71; color: #000; }
    .method.post { background: #3498db; color: #fff; }
    .path {
      font-family: monospace;
      color: #f39c12;
    }
    label {
      display: block;
      margin: 8px 0 4px;
      color: #aaa;
      font-size: 13px;
    }
    input, textarea, select {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #0f3460;
      border-radius: 4px;
      background: #0d1b2a;
      color: #eee;
      font-family: inherit;
      font-size: 14px;
    }
    input[type="number"] {
      font-family: monospace;
    }
    textarea {
      min-height: 80px;
      resize: vertical;
      font-family: monospace;
    }
    button {
      background: #e94560;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 10px;
    }
    button:hover {
      background: #ff6b6b;
    }
    button:disabled {
      background: #555;
      cursor: not-allowed;
    }
    .btn-secondary {
      background: #0f3460;
    }
    .btn-secondary:hover {
      background: #1a4a8a;
    }
    .btn-success {
      background: #27ae60;
    }
    .btn-success:hover {
      background: #2ecc71;
    }
    .btn-danger {
      background: #c0392b;
    }
    .btn-danger:hover {
      background: #e74c3c;
    }
    .btn-small {
      padding: 5px 10px;
      font-size: 12px;
      margin: 0;
    }
    .response {
      margin-top: 15px;
      padding: 15px;
      background: #0d1b2a;
      border-radius: 4px;
      border: 1px solid #0f3460;
      display: none;
    }
    .response.show {
      display: block;
    }
    .response pre {
      margin: 0;
      white-space: pre-wrap;
      word-break: break-all;
      font-size: 13px;
    }
    .response-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 12px;
    }
    .status.success { color: #2ecc71; }
    .status.error { color: #e74c3c; }
    .config-bar {
      background: #0f3460;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      gap: 20px;
      align-items: end;
    }
    .config-bar label {
      margin: 0;
    }
    .config-bar input {
      width: auto;
      min-width: 200px;
    }
    .config-bar .field {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    .tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 20px;
    }
    .tab {
      padding: 10px 20px;
      background: #16213e;
      border: 1px solid #0f3460;
      border-radius: 8px 8px 0 0;
      cursor: pointer;
      color: #aaa;
    }
    .tab.active {
      background: #0f3460;
      color: #6dd5ed;
      border-bottom-color: #0f3460;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    
    /* Form builder styles */
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }
    .form-group {
      display: flex;
      flex-direction: column;
    }
    .form-group.full-width {
      grid-column: 1 / -1;
    }
    .item-list {
      border: 1px solid #0f3460;
      border-radius: 4px;
      padding: 10px;
      margin-top: 10px;
      background: #0d1b2a;
    }
    .item-entry {
      background: #16213e;
      border: 1px solid #0f3460;
      border-radius: 4px;
      padding: 12px;
      margin-bottom: 10px;
      position: relative;
    }
    .item-entry:last-child {
      margin-bottom: 0;
    }
    .item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid #0f3460;
    }
    .item-title {
      font-weight: bold;
      color: #6dd5ed;
      font-size: 13px;
    }
    .remove-btn {
      background: #c0392b;
      color: white;
      border: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      margin: 0;
    }
    .remove-btn:hover {
      background: #e74c3c;
    }
    .add-item-btn {
      width: 100%;
      background: #27ae60;
      margin-top: 10px;
    }
    .add-item-btn:hover {
      background: #2ecc71;
    }
    .list-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .preview-section {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #0f3460;
    }
    .preview-toggle {
      font-size: 12px;
      color: #aaa;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .preview-toggle:hover {
      color: #6dd5ed;
    }
    .json-preview {
      margin-top: 10px;
      display: none;
    }
    .json-preview.show {
      display: block;
    }
    .empty-list {
      text-align: center;
      color: #666;
      padding: 20px;
      font-style: italic;
    }
    
    /* Block list in chunks */
    .blocks-container {
      max-height: 200px;
      overflow-y: auto;
      background: #0d1b2a;
      border-radius: 4px;
      padding: 8px;
    }
    .block-entry {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 2fr auto;
      gap: 8px;
      align-items: end;
      padding: 8px;
      background: #16213e;
      border-radius: 4px;
      margin-bottom: 6px;
    }
    .block-entry:last-child {
      margin-bottom: 0;
    }
    .block-entry input {
      padding: 6px 8px;
      font-size: 12px;
    }
    .block-entry label {
      font-size: 11px;
      margin-bottom: 2px;
    }
  </style>
</head>
<body>
  <div style="background: #0f3460; padding: 10px 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #1f4068; margin: -20px -20px 20px -20px;">
    <span style="color: #ccc; font-weight: bold;">Legacy API Manager</span>
    <div>
        <a href="index.html" style="color: #6dd5ed; text-decoration: none; margin-right: 15px; border: 1px solid #6dd5ed; padding: 5px 10px; border-radius: 4px;">Home</a>
        <a href="map.html" style="color: #6dd5ed; text-decoration: none; border: 1px solid #6dd5ed; padding: 5px 10px; border-radius: 4px;">Map Viewer</a>
    </div>
  </div>
  <h1>üó∫Ô∏è Minecraft Map API Tester</h1>
  
  <div class="config-bar">
    <div class="field">
      <label for="authToken">Auth Token</label>
      <input type="text" id="authToken" value="dev-token" placeholder="Authentication token">
    </div>
    <div class="field">
      <label for="baseUrl">Base URL</label>
      <input type="text" id="baseUrl" value="" placeholder="http://localhost:3000">
    </div>
  </div>

  <div class="tabs">
    <div class="tab active" data-tab="read">üìñ Read Endpoints</div>
    <div class="tab" data-tab="players">üë§ Players</div>
    <div class="tab" data-tab="entities">üêÑ Entities</div>
    <div class="tab" data-tab="blocks">üß± Blocks</div>
    <div class="tab" data-tab="chunks">üì¶ Chunks</div>
  </div>

  <!-- Read Endpoints -->
  <div id="read" class="tab-content active">
    <div class="section">
      <h2>Health Check</h2>
      <div class="endpoint">
        <div class="endpoint-header">
          <span class="method get">GET</span>
          <span class="path">/health</span>
        </div>
        <button onclick="makeRequest('GET', '/health', null, 'healthResponse')">Send Request</button>
        <div id="healthResponse" class="response"></div>
      </div>
    </div>

    <div class="section">
      <h2>Players</h2>
      <div class="endpoint">
        <div class="endpoint-header">
          <span class="method get">GET</span>
          <span class="path">/api/v1/players</span>
        </div>
        <label for="playersDimension">Filter by Dimension (optional)</label>
        <select id="playersDimension">
          <option value="">All dimensions</option>
          <option value="overworld">Overworld</option>
          <option value="nether">Nether</option>
          <option value="the_end">The End</option>
        </select>
        <button onclick="getPlayers()">Send Request</button>
        <div id="playersResponse" class="response"></div>
      </div>

      <div class="endpoint">
        <div class="endpoint-header">
          <span class="method get">GET</span>
          <span class="path">/api/v1/players/:name</span>
        </div>
        <label for="playerName">Player Name</label>
        <input type="text" id="playerName" placeholder="e.g., Steve">
        <button onclick="getPlayer()">Send Request</button>
        <div id="playerResponse" class="response"></div>
      </div>
    </div>

    <div class="section">
      <h2>World State</h2>
      <div class="endpoint">
        <div class="endpoint-header">
          <span class="method get">GET</span>
          <span class="path">/api/v1/world/state</span>
          <span style="color: #f39c12; font-size: 12px;">üîí Auth Required</span>
        </div>
        <button onclick="makeRequest('GET', '/api/v1/world/state', null, 'worldStateResponse', true)">Send Request</button>
        <div id="worldStateResponse" class="response"></div>
      </div>
    </div>
  </div>

  <!-- Players Tab -->
  <div id="players" class="tab-content">
    <div class="section">
      <h2>Update Players</h2>
      <div class="endpoint">
        <div class="endpoint-header">
          <span class="method post">POST</span>
          <span class="path">/api/v1/world/players</span>
          <span style="color: #f39c12; font-size: 12px;">üîí Auth Required</span>
        </div>
        
        <div class="item-list" id="playersList">
          <div class="empty-list">No players added. Click "Add Player" to get started.</div>
        </div>
        
        <button class="add-item-btn" onclick="addPlayer()">+ Add Player</button>
        
        <div class="list-actions">
          <button onclick="submitPlayers()">Send Request</button>
          <button class="btn-secondary" onclick="clearPlayers()">Clear All</button>
          <button class="btn-secondary" onclick="loadSamplePlayers()">Load Sample Data</button>
        </div>
        
        <div class="preview-section">
          <div class="preview-toggle" onclick="togglePreview('playersPreview')">
            üìã Show JSON Preview
          </div>
          <div id="playersPreview" class="json-preview">
            <textarea id="playersJson" readonly></textarea>
          </div>
        </div>
        
        <div id="updatePlayersResponse" class="response"></div>
      </div>
    </div>
  </div>

  <!-- Entities Tab -->
  <div id="entities" class="tab-content">
    <div class="section">
      <h2>Update Entities</h2>
      <div class="endpoint">
        <div class="endpoint-header">
          <span class="method post">POST</span>
          <span class="path">/api/v1/world/entities</span>
          <span style="color: #f39c12; font-size: 12px;">üîí Auth Required</span>
        </div>
        
        <div class="item-list" id="entitiesList">
          <div class="empty-list">No entities added. Click "Add Entity" to get started.</div>
        </div>
        
        <button class="add-item-btn" onclick="addEntity()">+ Add Entity</button>
        
        <div class="list-actions">
          <button onclick="submitEntities()">Send Request</button>
          <button class="btn-secondary" onclick="clearEntities()">Clear All</button>
          <button class="btn-secondary" onclick="loadSampleEntities()">Load Sample Data</button>
        </div>
        
        <div class="preview-section">
          <div class="preview-toggle" onclick="togglePreview('entitiesPreview')">
            üìã Show JSON Preview
          </div>
          <div id="entitiesPreview" class="json-preview">
            <textarea id="entitiesJson" readonly></textarea>
          </div>
        </div>
        
        <div id="updateEntitiesResponse" class="response"></div>
      </div>
    </div>
  </div>

  <!-- Blocks Tab -->
  <div id="blocks" class="tab-content">
    <div class="section">
      <h2>Update Blocks</h2>
      <div class="endpoint">
        <div class="endpoint-header">
          <span class="method post">POST</span>
          <span class="path">/api/v1/world/blocks</span>
          <span style="color: #f39c12; font-size: 12px;">üîí Auth Required</span>
        </div>
        
        <div class="item-list" id="blocksList">
          <div class="empty-list">No blocks added. Click "Add Block" to get started.</div>
        </div>
        
        <button class="add-item-btn" onclick="addBlock()">+ Add Block</button>
        
        <div class="list-actions">
          <button onclick="submitBlocks()">Send Request</button>
          <button class="btn-secondary" onclick="clearBlocks()">Clear All</button>
          <button class="btn-secondary" onclick="loadSampleBlocks()">Load Sample Data</button>
        </div>
        
        <div class="preview-section">
          <div class="preview-toggle" onclick="togglePreview('blocksPreview')">
            üìã Show JSON Preview
          </div>
          <div id="blocksPreview" class="json-preview">
            <textarea id="blocksJson" readonly></textarea>
          </div>
        </div>
        
        <div id="updateBlocksResponse" class="response"></div>
      </div>
    </div>
  </div>

  <!-- Chunks Tab -->
  <div id="chunks" class="tab-content">
    <div class="section">
      <h2>Update Chunks</h2>
      <div class="endpoint">
        <div class="endpoint-header">
          <span class="method post">POST</span>
          <span class="path">/api/v1/world/chunks</span>
          <span style="color: #f39c12; font-size: 12px;">üîí Auth Required</span>
        </div>
        
        <div class="item-list" id="chunksList">
          <div class="empty-list">No chunks added. Click "Add Chunk" to get started.</div>
        </div>
        
        <button class="add-item-btn" onclick="addChunk()">+ Add Chunk</button>
        
        <div class="list-actions">
          <button onclick="submitChunks()">Send Request</button>
          <button class="btn-secondary" onclick="clearChunks()">Clear All</button>
          <button class="btn-secondary" onclick="loadSampleChunks()">Load Sample Data</button>
        </div>
        
        <div class="preview-section">
          <div class="preview-toggle" onclick="togglePreview('chunksPreview')">
            üìã Show JSON Preview
          </div>
          <div id="chunksPreview" class="json-preview">
            <textarea id="chunksJson" readonly></textarea>
          </div>
        </div>
        
        <div id="updateChunksResponse" class="response"></div>
      </div>
    </div>
  </div>

  <script>
    // Data stores
    let players = [];
    let entities = [];
    let blocks = [];
    let chunks = [];
    let entityCounter = 1;
    let blockCounter = 1;

    // Set default base URL to current origin
    document.getElementById('baseUrl').value = window.location.origin;

    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
      });
    });

    function getBaseUrl() {
      return document.getElementById('baseUrl').value || window.location.origin;
    }

    function getAuthToken() {
      return document.getElementById('authToken').value;
    }

    async function makeRequest(method, path, body, responseId, requiresAuth = false) {
      const responseEl = document.getElementById(responseId);
      responseEl.classList.add('show');
      responseEl.innerHTML = '<pre>Loading...</pre>';

      const headers = {
        'Content-Type': 'application/json',
      };

      if (requiresAuth) {
        headers['x-mc-auth-token'] = getAuthToken();
      }

      const options = {
        method,
        headers,
      };

      if (body && method !== 'GET') {
        options.body = JSON.stringify(body);
      }

      try {
        const startTime = performance.now();
        const response = await fetch(getBaseUrl() + path, options);
        const duration = Math.round(performance.now() - startTime);
        const data = await response.json();
        
        const statusClass = response.ok ? 'success' : 'error';
        responseEl.innerHTML = `
          <div class="response-header">
            <span class="status ${statusClass}">Status: ${response.status} ${response.statusText}</span>
            <span>Duration: ${duration}ms</span>
          </div>
          <pre>${JSON.stringify(data, null, 2)}</pre>
        `;
      } catch (error) {
        responseEl.innerHTML = `
          <div class="response-header">
            <span class="status error">Error</span>
          </div>
          <pre>${error.message}</pre>
        `;
      }
    }

    function getPlayers() {
      const dimension = document.getElementById('playersDimension').value;
      const query = dimension ? `?dimension=${dimension}` : '';
      makeRequest('GET', '/api/v1/players' + query, null, 'playersResponse');
    }

    function getPlayer() {
      const name = document.getElementById('playerName').value;
      if (!name) {
        alert('Please enter a player name');
        return;
      }
      makeRequest('GET', `/api/v1/players/${encodeURIComponent(name)}`, null, 'playerResponse');
    }

    function togglePreview(previewId) {
      const preview = document.getElementById(previewId);
      preview.classList.toggle('show');
    }

    // ============ PLAYERS ============
    function renderPlayers() {
      const container = document.getElementById('playersList');
      if (players.length === 0) {
        container.innerHTML = '<div class="empty-list">No players added. Click "Add Player" to get started.</div>';
        return;
      }
      
      container.innerHTML = players.map((player, index) => `
        <div class="item-entry">
          <div class="item-header">
            <span class="item-title">üë§ Player ${index + 1}</span>
            <button class="remove-btn" onclick="removePlayer(${index})">√ó</button>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Name *</label>
              <input type="text" value="${player.name}" onchange="updatePlayer(${index}, 'name', this.value)" placeholder="Player name">
            </div>
            <div class="form-group">
              <label>Dimension *</label>
              <select onchange="updatePlayer(${index}, 'dimension', this.value)">
                <option value="overworld" ${player.dimension === 'overworld' ? 'selected' : ''}>Overworld</option>
                <option value="nether" ${player.dimension === 'nether' ? 'selected' : ''}>Nether</option>
                <option value="the_end" ${player.dimension === 'the_end' ? 'selected' : ''}>The End</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>X *</label>
              <input type="number" value="${player.x}" onchange="updatePlayer(${index}, 'x', parseFloat(this.value))">
            </div>
            <div class="form-group">
              <label>Y *</label>
              <input type="number" value="${player.y}" onchange="updatePlayer(${index}, 'y', parseFloat(this.value))">
            </div>
            <div class="form-group">
              <label>Z *</label>
              <input type="number" value="${player.z}" onchange="updatePlayer(${index}, 'z', parseFloat(this.value))">
            </div>
          </div>
        </div>
      `).join('');
      
      document.getElementById('playersJson').value = JSON.stringify({ players }, null, 2);
    }

    function addPlayer() {
      players.push({
        name: '',
        x: 0,
        y: 64,
        z: 0,
        dimension: 'overworld'
      });
      renderPlayers();
    }

    function removePlayer(index) {
      players.splice(index, 1);
      renderPlayers();
    }

    function updatePlayer(index, field, value) {
      players[index][field] = value;
      document.getElementById('playersJson').value = JSON.stringify({ players }, null, 2);
    }

    function clearPlayers() {
      players = [];
      renderPlayers();
    }

    function loadSamplePlayers() {
      players = [
        { name: "Steve", x: 100, y: 64, z: -50, dimension: "overworld" },
        { name: "Alex", x: 200, y: 70, z: 150, dimension: "overworld" },
        { name: "NetherExplorer", x: 50, y: 100, z: 25, dimension: "nether" }
      ];
      renderPlayers();
    }

    function submitPlayers() {
      if (players.length === 0) {
        alert('Please add at least one player');
        return;
      }
      makeRequest('POST', '/api/v1/world/players', { players }, 'updatePlayersResponse', true);
    }

    // ============ ENTITIES ============
    function renderEntities() {
      const container = document.getElementById('entitiesList');
      if (entities.length === 0) {
        container.innerHTML = '<div class="empty-list">No entities added. Click "Add Entity" to get started.</div>';
        return;
      }
      
      container.innerHTML = entities.map((entity, index) => `
        <div class="item-entry">
          <div class="item-header">
            <span class="item-title">üêÑ Entity ${index + 1}</span>
            <button class="remove-btn" onclick="removeEntity(${index})">√ó</button>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>ID *</label>
              <input type="text" value="${entity.id}" onchange="updateEntity(${index}, 'id', this.value)" placeholder="entity-001">
            </div>
            <div class="form-group">
              <label>Type *</label>
              <input type="text" value="${entity.type}" onchange="updateEntity(${index}, 'type', this.value)" placeholder="minecraft:villager" list="entityTypes">
            </div>
            <div class="form-group">
              <label>Dimension *</label>
              <select onchange="updateEntity(${index}, 'dimension', this.value)">
                <option value="overworld" ${entity.dimension === 'overworld' ? 'selected' : ''}>Overworld</option>
                <option value="nether" ${entity.dimension === 'nether' ? 'selected' : ''}>Nether</option>
                <option value="the_end" ${entity.dimension === 'the_end' ? 'selected' : ''}>The End</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>X *</label>
              <input type="number" value="${entity.x}" onchange="updateEntity(${index}, 'x', parseFloat(this.value))">
            </div>
            <div class="form-group">
              <label>Y *</label>
              <input type="number" value="${entity.y}" onchange="updateEntity(${index}, 'y', parseFloat(this.value))">
            </div>
            <div class="form-group">
              <label>Z *</label>
              <input type="number" value="${entity.z}" onchange="updateEntity(${index}, 'z', parseFloat(this.value))">
            </div>
          </div>
        </div>
      `).join('');
      
      document.getElementById('entitiesJson').value = JSON.stringify({ entities }, null, 2);
    }

    function addEntity() {
      entities.push({
        id: `entity-${String(entityCounter++).padStart(3, '0')}`,
        type: 'minecraft:villager',
        x: 0,
        y: 64,
        z: 0,
        dimension: 'overworld'
      });
      renderEntities();
    }

    function removeEntity(index) {
      entities.splice(index, 1);
      renderEntities();
    }

    function updateEntity(index, field, value) {
      entities[index][field] = value;
      document.getElementById('entitiesJson').value = JSON.stringify({ entities }, null, 2);
    }

    function clearEntities() {
      entities = [];
      entityCounter = 1;
      renderEntities();
    }

    function loadSampleEntities() {
      entities = [
        { id: "entity-001", type: "minecraft:villager", x: 120, y: 64, z: -30, dimension: "overworld" },
        { id: "entity-002", type: "minecraft:horse", x: 125, y: 64, z: -35, dimension: "overworld" },
        { id: "entity-003", type: "minecraft:zombified_piglin", x: 40, y: 80, z: 20, dimension: "nether" }
      ];
      entityCounter = 4;
      renderEntities();
    }

    function submitEntities() {
      if (entities.length === 0) {
        alert('Please add at least one entity');
        return;
      }
      makeRequest('POST', '/api/v1/world/entities', { entities }, 'updateEntitiesResponse', true);
    }

    // ============ BLOCKS ============
    function renderBlocks() {
      const container = document.getElementById('blocksList');
      if (blocks.length === 0) {
        container.innerHTML = '<div class="empty-list">No blocks added. Click "Add Block" to get started.</div>';
        return;
      }
      
      container.innerHTML = blocks.map((block, index) => `
        <div class="item-entry">
          <div class="item-header">
            <span class="item-title">üß± Block ${index + 1}</span>
            <button class="remove-btn" onclick="removeBlock(${index})">√ó</button>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Block Type *</label>
              <input type="text" value="${block.blockType}" onchange="updateBlock(${index}, 'blockType', this.value)" placeholder="minecraft:diamond_block" list="blockTypes">
            </div>
            <div class="form-group">
              <label>Dimension *</label>
              <select onchange="updateBlock(${index}, 'dimension', this.value)">
                <option value="overworld" ${block.dimension === 'overworld' ? 'selected' : ''}>Overworld</option>
                <option value="nether" ${block.dimension === 'nether' ? 'selected' : ''}>Nether</option>
                <option value="the_end" ${block.dimension === 'the_end' ? 'selected' : ''}>The End</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>X *</label>
              <input type="number" value="${block.x}" onchange="updateBlock(${index}, 'x', parseInt(this.value))">
            </div>
            <div class="form-group">
              <label>Y *</label>
              <input type="number" value="${block.y}" onchange="updateBlock(${index}, 'y', parseInt(this.value))">
            </div>
            <div class="form-group">
              <label>Z *</label>
              <input type="number" value="${block.z}" onchange="updateBlock(${index}, 'z', parseInt(this.value))">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Previous Type (optional)</label>
              <input type="text" value="${block.previousType || ''}" onchange="updateBlock(${index}, 'previousType', this.value || undefined)" placeholder="minecraft:stone">
            </div>
            <div class="form-group">
              <label>Player (optional)</label>
              <input type="text" value="${block.player || ''}" onchange="updateBlock(${index}, 'player', this.value || undefined)" placeholder="Steve">
            </div>
          </div>
        </div>
      `).join('');
      
      document.getElementById('blocksJson').value = JSON.stringify({ blocks }, null, 2);
    }

    function addBlock() {
      blocks.push({
        dimension: 'overworld',
        x: 0,
        y: 64,
        z: 0,
        blockType: 'minecraft:stone'
      });
      renderBlocks();
    }

    function removeBlock(index) {
      blocks.splice(index, 1);
      renderBlocks();
    }

    function updateBlock(index, field, value) {
      if (value === undefined) {
        delete blocks[index][field];
      } else {
        blocks[index][field] = value;
      }
      document.getElementById('blocksJson').value = JSON.stringify({ blocks }, null, 2);
    }

    function clearBlocks() {
      blocks = [];
      renderBlocks();
    }

    function loadSampleBlocks() {
      blocks = [
        { dimension: "overworld", x: 100, y: 64, z: -50, blockType: "minecraft:diamond_block", previousType: "minecraft:stone", player: "Steve" },
        { dimension: "overworld", x: 101, y: 64, z: -50, blockType: "minecraft:gold_block" }
      ];
      renderBlocks();
    }

    function submitBlocks() {
      if (blocks.length === 0) {
        alert('Please add at least one block');
        return;
      }
      makeRequest('POST', '/api/v1/world/blocks', { blocks }, 'updateBlocksResponse', true);
    }

    // ============ CHUNKS ============
    function renderChunks() {
      const container = document.getElementById('chunksList');
      if (chunks.length === 0) {
        container.innerHTML = '<div class="empty-list">No chunks added. Click "Add Chunk" to get started.</div>';
        return;
      }
      
      container.innerHTML = chunks.map((chunk, chunkIndex) => {
        const blockCount = chunk.blocks.length; 
        const showBlocks = chunk._showBlocks || false; // Store UI state in object (dirty but works)
        
        return `
        <div class="item-entry">
          <div class="item-header">
            <span class="item-title">üì¶ Chunk ${chunkIndex + 1}</span>
            <button class="remove-btn" onclick="removeChunk(${chunkIndex})">√ó</button>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Chunk X *</label>
              <input type="number" value="${chunk.chunkX}" onchange="updateChunk(${chunkIndex}, 'chunkX', parseInt(this.value))">
            </div>
            <div class="form-group">
              <label>Chunk Z *</label>
              <input type="number" value="${chunk.chunkZ}" onchange="updateChunk(${chunkIndex}, 'chunkZ', parseInt(this.value))">
            </div>
            <div class="form-group">
              <label>Dimension *</label>
              <select onchange="updateChunk(${chunkIndex}, 'dimension', this.value)">
                <option value="overworld" ${chunk.dimension === 'overworld' ? 'selected' : ''}>Overworld</option>
                <option value="nether" ${chunk.dimension === 'nether' ? 'selected' : ''}>Nether</option>
                <option value="the_end" ${chunk.dimension === 'the_end' ? 'selected' : ''}>The End</option>
              </select>
            </div>
          </div>
          
          <div class="chunk-tools" style="background: #0f2444; padding: 10px; margin: 10px 0; border-radius: 4px; border: 1px dashed #1f4068;">
            <h4 style="margin-top: 0; margin-bottom: 10px; color: #b8d4e3; font-size: 13px;">üõ†Ô∏è Chunk Tools</h4>
            
            <div class="form-row">
                <div class="form-group full-width">
                    <label>Fill Layer / Range</label>
                    <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                        <input type="number" placeholder="Y Start" id="fillYStart-${chunkIndex}" value="64" style="width: 80px;">
                        <input type="number" placeholder="Y End" id="fillYEnd-${chunkIndex}" value="64" style="width: 80px;">
                        <input type="text" placeholder="Block Type" id="fillType-${chunkIndex}" value="minecraft:stone" list="blockTypes" style="flex-grow: 1; min-width: 150px;">
                        <button class="btn-small btn-success" onclick="fillChunk(${chunkIndex})" style="margin: 0;">Fill Range</button>
                    </div>
                </div>
            </div>
            
            <div class="form-row" style="margin-top: 10px;">
                <div class="form-group full-width">
                    <label>Presets (Overwrites existing blocks)</label>
                    <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                        <button class="btn-small btn-secondary" onclick="presetFlat(${chunkIndex})">Flat (Grass)</button>
                        <button class="btn-small btn-secondary" onclick="presetOcean(${chunkIndex})">Ocean</button>
                        <button class="btn-small btn-secondary" onclick="presetPlatform(${chunkIndex})">Stone Platform</button>
                        <button class="btn-small btn-danger" onclick="clearChunkBlocks(${chunkIndex})">Clear All Blocks</button>
                    </div>
                </div>
            </div>
          </div>

          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
             <h3>Blocks in Chunk (${blockCount})</h3>
             <button class="btn-small btn-secondary" onclick="toggleChunkBlocks(${chunkIndex})">${showBlocks ? 'Hide Blocks' : 'Show Blocks'}</button>
          </div>
          
          ${showBlocks ? `
          <div class="blocks-container">
            ${chunk.blocks.slice(0, 100).map((block, blockIndex) => `
              <div class="block-entry">
                <div class="form-group">
                  <label>X</label>
                  <input type="number" value="${block.x}" readonly title="X (Absolute)">
                </div>
                <div class="form-group">
                  <label>Y</label>
                  <input type="number" value="${block.y}" onchange="updateChunkBlock(${chunkIndex}, ${blockIndex}, 'y', parseInt(this.value))">
                </div>
                <div class="form-group">
                  <label>Z</label>
                  <input type="number" value="${block.z}" readonly title="Z (Absolute)">
                </div>
                <div class="form-group">
                  <label>Type</label>
                  <input type="text" value="${block.type}" onchange="updateChunkBlock(${chunkIndex}, ${blockIndex}, 'type', this.value)" list="blockTypes">
                </div>
                <button class="remove-btn" onclick="removeChunkBlock(${chunkIndex}, ${blockIndex})">√ó</button>
              </div>
            `).join('')}
            ${blockCount > 100 ? `<div style="text-align: center; padding: 10px; color: #888;">... and ${blockCount - 100} more blocks (display truncated)</div>` : ''}
            ${blockCount === 0 ? '<div class="empty-list" style="padding: 10px;">No blocks in chunk</div>' : ''}
          </div>
          <button class="btn-small btn-success" onclick="addChunkBlock(${chunkIndex})" style="margin-top: 8px;">+ Add Block (Manual)</button>
          ` : ''}
        </div>
      `}).join('');
      
      document.getElementById('chunksJson').value = JSON.stringify({ chunks }, null, 2);
    }
    
    function toggleChunkBlocks(index) {
        chunks[index]._showBlocks = !chunks[index]._showBlocks;
        renderChunks();
    }
    
    function fillChunk(chunkIndex) {
        const chunk = chunks[chunkIndex];
        const yStart = parseInt(document.getElementById(`fillYStart-${chunkIndex}`).value);
        const yEnd = parseInt(document.getElementById(`fillYEnd-${chunkIndex}`).value);
        const type = document.getElementById(`fillType-${chunkIndex}`).value;
        
        if (isNaN(yStart) || isNaN(yEnd) || !type) {
            alert("Invalid input parameters");
            return;
        }
        
        // Calculate absolute offsets
        const startX = chunk.chunkX * 16;
        const startZ = chunk.chunkZ * 16;
        
        const newBlocks = [];
        
        // Loop Y range
        const minY = Math.min(yStart, yEnd);
        const maxY = Math.max(yStart, yEnd);
        
        for (let y = minY; y <= maxY; y++) {
            // Full 16x16 horizontal slice
            for (let x = 0; x < 16; x++) {
                for (let z = 0; z < 16; z++) {
                    newBlocks.push({
                        x: startX + x,
                        y: y,
                        z: startZ + z,
                        type: type
                    });
                }
            }
        }
        
        // Append
        chunk.blocks.push(...newBlocks);
        
        // Force show blocks if count was low, otherwise keep hidden to avoid lag
        if (chunk.blocks.length < 50) {
            chunk._showBlocks = true;
        }
        
        renderChunks();
    }
    
    function clearChunkBlocks(index) {
        if(confirm('Are you sure you want to clear all blocks in this chunk?')) {
            chunks[index].blocks = [];
            renderChunks();
        }
    }
    
    function presetFlat(index) {
        const chunk = chunks[index];
        chunk.blocks = []; // Clear first
        
        const startX = chunk.chunkX * 16;
        const startZ = chunk.chunkZ * 16;
        
        // 1. Bedrock Layer (-64)
        for(let x=0; x<16; x++) {
            for(let z=0; z<16; z++) {
                chunk.blocks.push({ x: startX+x, y: -64, z: startZ+z, type: "minecraft:bedrock" });
            }
        }
        
        // 2. Stone Layers (-63 to 60) - sparse? No, let's just do top layers to save data size for testing
        // Creating ~120 layers of stone is heavily impactful on browser (16*16*120 ~ 30k objects).
        // Let's just create the surface layers for visualization testing.
        
        // Dirt (60-62)
        for(let y=60; y<=62; y++) {
            for(let x=0; x<16; x++) {
                for(let z=0; z<16; z++) {
                    chunk.blocks.push({ x: startX+x, y: y, z: startZ+z, type: "minecraft:dirt" });
                }
            }
        }
        
        // Grass (63)
        for(let x=0; x<16; x++) {
            for(let z=0; z<16; z++) {
                chunk.blocks.push({ x: startX+x, y: 63, z: startZ+z, type: "minecraft:grass_block" });
            }
        }
        
        alert(`Generated ${chunk.blocks.length} blocks for Flat Preset`);
        renderChunks();
    }
    
    function presetOcean(index) {
        const chunk = chunks[index];
        chunk.blocks = [];
        
        const startX = chunk.chunkX * 16;
        const startZ = chunk.chunkZ * 16;
        
        // Sand bottom (45)
        for(let x=0; x<16; x++) {
            for(let z=0; z<16; z++) {
                chunk.blocks.push({ x: startX+x, y: 45, z: startZ+z, type: "minecraft:sand" });
            }
        }
        
        // Water (46-62)
        for(let y=46; y<=62; y++) {
            for(let x=0; x<16; x++) {
                for(let z=0; z<16; z++) {
                    chunk.blocks.push({ x: startX+x, y: y, z: startZ+z, type: "minecraft:water" });
                }
            }
        }
        
        renderChunks();
    }
    
    function presetPlatform(index) {
         const chunk = chunks[index];
        chunk.blocks = [];
        
        const startX = chunk.chunkX * 16;
        const startZ = chunk.chunkZ * 16;
        
        // Stone platform at 100
        for(let x=0; x<16; x++) {
            for(let z=0; z<16; z++) {
                chunk.blocks.push({ x: startX+x, y: 100, z: startZ+z, type: "minecraft:stone_bricks" });
            }
        }
        renderChunks();
    }

    function addChunk() {
      chunks.push({
        dimension: 'overworld',
        chunkX: 0,
        chunkZ: 0,
        blocks: []
      });
      renderChunks();
    }

    function removeChunk(index) {
      chunks.splice(index, 1);
      renderChunks();
    }

    function updateChunk(index, field, value) {
      chunks[index][field] = value;
      document.getElementById('chunksJson').value = JSON.stringify({ chunks }, null, 2);
    }

    function addChunkBlock(chunkIndex) {
      chunks[chunkIndex].blocks.push({
        x: 0,
        y: 64,
        z: 0,
        type: 'minecraft:stone'
      });
      renderChunks();
    }

    function removeChunkBlock(chunkIndex, blockIndex) {
      chunks[chunkIndex].blocks.splice(blockIndex, 1);
      renderChunks();
    }

    function updateChunkBlock(chunkIndex, blockIndex, field, value) {
      chunks[chunkIndex].blocks[blockIndex][field] = value;
      document.getElementById('chunksJson').value = JSON.stringify({ chunks }, null, 2);
    }

    function clearChunks() {
      chunks = [];
      renderChunks();
    }

    function loadSampleChunks() {
      chunks = [
        {
          dimension: "overworld",
          chunkX: 0,
          chunkZ: 0,
          blocks: [
            { x: 0, y: 64, z: 0, type: "minecraft:grass_block" },
            { x: 1, y: 64, z: 0, type: "minecraft:grass_block" },
            { x: 0, y: 63, z: 0, type: "minecraft:dirt" },
            { x: 1, y: 63, z: 0, type: "minecraft:dirt" }
          ]
        }
      ];
      renderChunks();
    }

    function submitChunks() {
      if (chunks.length === 0) {
        alert('Please add at least one chunk');
        return;
      }
      makeRequest('POST', '/api/v1/world/chunks', { chunks }, 'updateChunksResponse', true);
    }

    // Initialize empty lists
    renderPlayers();
    renderEntities();
    renderBlocks();
    renderChunks();
  </script>
  
  <!-- Datalists for autocomplete suggestions -->
  <datalist id="entityTypes">
    <option value="minecraft:villager">
    <option value="minecraft:horse">
    <option value="minecraft:cow">
    <option value="minecraft:pig">
    <option value="minecraft:sheep">
    <option value="minecraft:chicken">
    <option value="minecraft:wolf">
    <option value="minecraft:cat">
    <option value="minecraft:zombie">
    <option value="minecraft:skeleton">
    <option value="minecraft:creeper">
    <option value="minecraft:spider">
    <option value="minecraft:enderman">
    <option value="minecraft:zombified_piglin">
    <option value="minecraft:blaze">
    <option value="minecraft:ghast">
  </datalist>
  
  <datalist id="blockTypes">
    <option value="minecraft:stone">
    <option value="minecraft:dirt">
    <option value="minecraft:grass_block">
    <option value="minecraft:cobblestone">
    <option value="minecraft:oak_planks">
    <option value="minecraft:oak_log">
    <option value="minecraft:diamond_block">
    <option value="minecraft:gold_block">
    <option value="minecraft:iron_block">
    <option value="minecraft:emerald_block">
    <option value="minecraft:netherrack">
    <option value="minecraft:end_stone">
    <option value="minecraft:obsidian">
    <option value="minecraft:bedrock">
    <option value="minecraft:water">
    <option value="minecraft:lava">
  </datalist>
</body>
</html>
